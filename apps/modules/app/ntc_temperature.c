

/*================================================================
 *   
 *   
 *   文件名称：ntc_temperature.c
 *   创 建 者：肖飞
 *   创建日期：2021年05月15日 星期六 16时42分24秒
 *   修改日期：2021年05月15日 星期六 16时48分05秒
 *   描    述：
 *
 *================================================================*/
#include "ntc_temperature.h"
#include "os_utils.h"

typedef struct {
	int temperature;
	uint32_t resistor;
} temperature_resistor_item_t;

const temperature_resistor_item_t temperature_resistor_items[] = {
	{-40, 335745},
	{-39, 314213},
	{-38, 294198},
	{-37, 275584},
	{-36, 258265},
	{-35, 242142},
	{-34, 227126},
	{-33, 213135},
	{-32, 200093},
	{-31, 187929},
	{-30, 176580},
	{-29, 165987},
	{-28, 156094},
	{-27, 146852},
	{-26, 138213},
	{-25, 130136},
	{-24, 122579},
	{-23, 115508},
	{-22, 108887},
	{-21, 102687},
	{-20, 96876},
	{-19, 91430},
	{-18, 86323},
	{-17, 81531},
	{-16, 77035},
	{-15, 72813},
	{-14, 68848},
	{-13, 65123},
	{-12, 61621},
	{-11, 58328},
	{-10, 55231},
	{-9, 52317},
	{-8, 49574},
	{-7, 46990},
	{-6, 44557},
	{-5, 42264},
	{-4, 40102},
	{-3, 38064},
	{-2, 36141},
	{-1, 34326},
	{0, 32613},
	{1, 30996},
	{2, 29468},
	{3, 28024},
	{4, 26660},
	{5, 25370},
	{6, 24149},
	{7, 22994},
	{8, 21901},
	{9, 20867},
	{10, 19888},
	{11, 18959},
	{12, 18079},
	{13, 17245},
	{14, 16454},
	{15, 15704},
	{16, 14993},
	{17, 14317},
	{18, 13676},
	{19, 13067},
	{20, 12489},
	{21, 11940},
	{22, 11417},
	{23, 10921},
	{24, 10449},
	{25, 10000},
	{26, 9572},
	{27, 9165},
	{28, 8778},
	{29, 8409},
	{30, 8058},
	{31, 7724},
	{32, 7405},
	{33, 7101},
	{34, 6811},
	{35, 6534},
	{36, 6271},
	{37, 6019},
	{38, 5779},
	{39, 5549},
	{40, 5330},
	{41, 5121},
	{42, 4921},
	{43, 4730},
	{44, 4547},
	{45, 4373},
	{46, 4206},
	{47, 4046},
	{48, 3893},
	{49, 3747},
	{50, 3607},
	{51, 3473},
	{52, 3345},
	{53, 3222},
	{54, 3104},
	{55, 2991},
	{56, 2883},
	{57, 2780},
	{58, 2680},
	{59, 2585},
	{60, 2493},
	{61, 2405},
	{62, 2321},
	{63, 2240},
	{64, 2163},
	{65, 2088},
	{66, 2017},
	{67, 1948},
	{68, 1882},
	{69, 1818},
	{70, 1757},
	{71, 1698},
	{72, 1642},
	{73, 1588},
	{74, 1535},
	{75, 1485},
	{76, 1437},
	{77, 1390},
	{78, 1345},
	{79, 1302},
	{80, 1261},
	{81, 1221},
	{82, 1182},
	{83, 1145},
	{84, 1109},
	{85, 1075},
	{86, 1041},
	{87, 1008},
	{88, 978},
	{89, 948},
	{90, 920},
	{91, 892},
	{92, 865},
	{93, 839},
	{94, 814},
	{95, 790},
	{96, 767},
	{97, 744},
	{98, 722},
	{99, 701},
	{100, 681},
	{101, 662},
	{102, 643},
	{103, 624},
	{104, 607},
	{105, 589},
	{106, 573},
	{107, 557},
	{108, 541},
	{109, 526},
	{110, 512},
	{111, 498},
	{112, 484},
	{113, 471},
	{114, 458},
	{115, 446},
	{116, 434},
	{117, 422},
	{118, 411},
	{119, 400},
	{120, 390},
	{121, 379},
	{122, 369},
	{123, 360},
	{124, 351},
	{125, 342},
};

int get_ntc_temperature(uint32_t ref_resistor, uint16_t adc_value, uint16_t adc_max)
{
	uint32_t ntc_resistor;
	int ntc_temperature = -40;
	int i;

	if(adc_value == 0) {
		return ntc_temperature;
	}

	ntc_resistor = ref_resistor * (adc_max  - adc_value) / (adc_value);

	for(i = 0; i < ARRAY_SIZE(temperature_resistor_items); i++) {
		const temperature_resistor_item_t *item = temperature_resistor_items + i;

		if(ntc_resistor >= item->resistor) {
			ntc_temperature = item->temperature;
			break;
		}
	}

	return ntc_temperature;
}
